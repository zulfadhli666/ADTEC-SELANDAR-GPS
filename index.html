<!DOCTYPE html>
<html>
<head>
  <title>College GPS - Google Maps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body { margin: 0; font-family: Arial; }
    #map { height: 70vh; width: 100%; }
    #controls { padding: 10px; background: #f4f4f4; }
    select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      font-size: 16px;
    }
  </style>
</head>

<body>

<h2 style="text-align:center;">üìç College GPS (Google Maps)</h2>

<div id="map"></div>

<div id="controls">
  <select id="destination">
    <option value="">-- Select Destination --</option>
  </select>
  <button onclick="startNavigation()">üß≠ Start Navigation</button>
  <p id="info"></p>
</div>

<script>
let map;
let directionsService;
let directionsRenderer;
let userPosition;
let lastSpoken = 0;

// Locations
const locations = [
  { name: "Library", lat: 2.397140, lng: 102.381964 },
  { name: "Admin", lat: 2.396595, lng: 102.381809 },
  { name: "Canteen", lat: 2.396646, lng: 102.381235 },
  { name: "Surau", lat: 2.397047, lng: 102.378232 }
];

// Initialize Map
function initMap() {

  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 17,
    center: { lat: 2.3966, lng: 102.3808 }
  });

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);

  // Add markers
  locations.forEach(loc => {
    new google.maps.Marker({
      position: { lat: loc.lat, lng: loc.lng },
      map: map,
      title: loc.name
    });
  });

  // Dropdown
  const dropdown = document.getElementById("destination");
  locations.forEach((loc, i) => {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = loc.name;
    dropdown.appendChild(option);
  });
}

// Voice
function speak(text) {
  const speech = new SpeechSynthesisUtterance(text);
  speech.lang = "en-US";
  window.speechSynthesis.speak(speech);
}

// Start Navigation
function startNavigation() {

  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }

  const selectedIndex = document.getElementById("destination").value;
  if (selectedIndex === "") {
    alert("Select destination");
    return;
  }

  const dest = locations[selectedIndex];

  navigator.geolocation.watchPosition(position => {

    userPosition = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };

    calculateRoute(dest);

  }, null, { enableHighAccuracy: true });
}

// Calculate Route
function calculateRoute(dest) {

  const request = {
    origin: userPosition,
    destination: { lat: dest.lat, lng: dest.lng },
    travelMode: "WALKING"
  };

  directionsService.route(request, function(result, status) {
    if (status === "OK") {

      directionsRenderer.setDirections(result);

      const leg = result.routes[0].legs[0];
      document.getElementById("info").innerHTML =
        "Distance: " + leg.distance.text +
        "<br>Duration: " + leg.duration.text;

      // Voice every 15 seconds
      const now = Date.now();
      if (now - lastSpoken > 15000) {
        speak("Distance " + leg.distance.text);
        lastSpoken = now;
      }
    }
  });
}
</script>

<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAk7WztnXaQVqxu-op5aRhnkGkpdsb11yAE&callback=initMap">
</script>

</body>
</html>
